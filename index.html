<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Electron Cube Timer</title>
  </head>
  <body>
    <h1>Electron Cube Timer Goes Here!</h1>
    <!-- All of the Node.js APIs are available in this renderer process. -->
    <div>Number of milliseconds since 1 January 1970 00:00:00 UTC</div>
    <div id="getTimeDisplay" style="margin-bottom:10px"></div>

    <div>Start Time</div>
    <div id="startTimeDisplay" style="margin-bottom:10px"></div>

    <div>Elapsed Time</div>
    <div id="elapsedTimeDisplay" style="margin-bottom:10px"></div>

    <div>Timer LCD</div>
    <span id="elapsedMinutesDisplay"></span>:<span id="elapsedSecondsDisplay"></span>:<span id="elapsedMillisecondsDisplay"></span>

    <p>Spacebar will start and stop the timer.</p>

    <p>
    We are using node <script>document.write(process.versions.node)</script>,
    Chromium <script>document.write(process.versions.chrome)</script>,
    and Electron <script>document.write(process.versions.electron)</script>.
    </p>
  </body>
  <script>
    function handleKeyUp(e)
    {
      // State: Standby
      if(stateId == 1)
      {
        if(e.keyCode == 32)
        {
          // Goto: Start
          stateId = 2

          startDate = new Date();
          timerInterval = window.setInterval(updateTimerDisplay, 1)
        }
      } else
      // State: Stopby
      if(stateId == 3)
      {
        if(e.keyCode == 32)
        {
          // Goto: Stop
          stateId = 4
        }
      }
    }

    function handleKeyDown(e)
    {
      // State: Reset
      if(stateId == 0)
      {
        if(e.keyCode == 32)
        {
          // Goto: Standby
          stateId = 1
        }
      } else
      // State: Start
      if(stateId == 2)
      {
        if(e.keyCode == 32)
        {
          // Goto: Stop
          stateId = 3

          window.clearInterval(timerInterval)
        }
      }
    }

    function handleKeyPress(e)
    {
      // State: Stop
      if(stateId == 4)
      {
        if(e.keyCode == 32)
        {
          // Goto: Reset
          stateId = 0

          window.clearInterval(timerInterval)
          resetTimerDisplay()
        }
      }
    }

    function pad(num, size) {
        var s = "000000000" + num;
        return s.substr(s.length-size);
    }

    function updateTimerDisplay()
    {
      var startTime = startDate.getTime()

      var newDate = new Date()
      var newTime = newDate.getTime()
      var elapsedTime = newTime - startTime

      var elapsedMilliseconds = elapsedTime % 1000
      var elapsedSeconds = Math.floor(elapsedTime / 1000) % 60
      var elapsedMinutes = Math.floor(elapsedTime / (60 * 1000))

      var getTimeDisplay = document.getElementById('getTimeDisplay')
      var startTimeDisplay = document.getElementById('startTimeDisplay')
      var elapsedMillisecondsDisplay = document.getElementById('elapsedMillisecondsDisplay')
      var elapsedSecondsDisplay = document.getElementById('elapsedSecondsDisplay')
      var elapsedMinutesDisplay = document.getElementById('elapsedMinutesDisplay')

      startTimeDisplay.innerHTML = startTime
      getTimeDisplay.innerHTML = newTime
      elapsedTimeDisplay.innerHTML = elapsedTime
      elapsedMillisecondsDisplay.innerHTML = pad(elapsedMilliseconds, 3)
      elapsedSecondsDisplay.innerHTML = pad(elapsedSeconds, 2)
      elapsedMinutesDisplay.innerHTML = pad(elapsedMinutes, 2)
    }

    function resetTimerDisplay()
    {
      var getTimeDisplay = document.getElementById('getTimeDisplay')
      var startTimeDisplay = document.getElementById('startTimeDisplay')
      var elapsedMillisecondsDisplay = document.getElementById('elapsedMillisecondsDisplay')
      var elapsedSecondsDisplay = document.getElementById('elapsedSecondsDisplay')
      var elapsedMinutesDisplay = document.getElementById('elapsedMinutesDisplay')

      startTimeDisplay.innerHTML = ''
      getTimeDisplay.innerHTML = ''
      elapsedTimeDisplay.innerHTML = ''
      elapsedMillisecondsDisplay.innerHTML = ''
      elapsedSecondsDisplay.innerHTML = ''
      elapsedMinutesDisplay.innerHTML = ''
    }

    var timerInterval = 0
    var startDate;
    var stateId = 0;

    window.addEventListener("keyup", handleKeyUp)
    window.addEventListener("keydown", handleKeyDown)
    window.addEventListener("keypress", handleKeyPress)
  </script>
  <script src="./app.js"></script>
  <script>
    // You can also require other files to run in this process
    /*require('./renderer.js')*/
  </script>
</html>
