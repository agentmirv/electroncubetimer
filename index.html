<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Electron Cube Timer</title>
    <style>
    .lcd {
      font-family: monospace;
      font-size: 100px;
      font-style: italic;
      font-variant: normal;
      font-weight: 500;
      line-height: 110px;
      white-space: pre;
    }
    </style>
  </head>
  <body>
    <h1>Electron Cube Timer</h1>
    <!-- All of the Node.js APIs are available in this renderer process. -->
    <span class="lcd"><span id="timerMinutes"></span><span id="timerSeconds"></span><span id="timerMilliseconds"></span></span>

    <p><span>Status: <span><span id="state">Ready</span></p>

    <p>Spacebar will start and stop the timer.</p>

    <p>
    We are using node <script>document.write(process.versions.node)</script>,
    Chromium <script>document.write(process.versions.chrome)</script>,
    and Electron <script>document.write(process.versions.electron)</script>.
    </p>
  </body>
  <script>
    function handleKeyUp(e)
    {
      // State: Standby
      if(stateId == 1)
      {
        if(e.keyCode == 32)
        {
          // Goto: Running
          stateId = 2

          startDate = new Date();
          timerInterval = window.setInterval(updateTimerDisplay, 1)

          document.getElementById('state').innerHTML = 'Running'
        }
      } else
      // State: Stop
      if(stateId == 3)
      {
        if(e.keyCode == 32)
        {
          // Goto: Resting
          stateId = 4

          document.getElementById('state').innerHTML = 'Resting'
        }
      } else
      // State: Reset
      if(stateId == 5)
      {
        if(e.keyCode == 32)
        {
          // Goto: Ready
          stateId = 0

          document.getElementById('state').innerHTML = 'Ready'
        }
      }
    }

    function handleKeyDown(e)
    {
      // State: Reset
      if(stateId == 0)
      {
        if(e.keyCode == 32)
        {
          // Goto: Standby
          stateId = 1

          document.getElementById('state').innerHTML = 'Standby'
        }
      } else
      // State: Start
      if(stateId == 2)
      {
        if(e.keyCode == 32)
        {
          // Goto: Stop
          stateId = 3

          window.clearInterval(timerInterval)

          document.getElementById('state').innerHTML = 'Stop'
        }
      } else
      // State: Resting
      if(stateId == 4)
      {
        if(e.keyCode == 32)
        {
          // Goto: Reset
          stateId = 5

          window.clearInterval(timerInterval)
          resetTimerDisplay()

          document.getElementById('state').innerHTML = 'Reset'
        }
      }
    }

    function padZero(num, size) {
        var s = "000000000" + num;
        return s.substr(s.length-size);
    }

    function padSpace(num, size) {
        var s = "         " + num;
        return s.substr(s.length-size);
    }

    function updateTimerDisplay()
    {
      var startTime = startDate.getTime()

      var newDate = new Date()
      var newTime = newDate.getTime()
      var elapsedTime = newTime - startTime

      var elapsedMilliseconds = elapsedTime
      var elapsedSeconds = Math.floor(elapsedTime / 1000)
      var elapsedMinutes = Math.floor(elapsedTime / (60 * 1000))

      var displayMilliseconds = elapsedMilliseconds % 1000
      var displaySeconds = elapsedSeconds % 60
      var displayMinutes = elapsedMinutes

      var timerMilliseconds = document.getElementById('timerMilliseconds')
      var timerSeconds = document.getElementById('timerSeconds')
      var timerMinutes = document.getElementById('timerMinutes')

      timerMilliseconds.innerHTML = padZero(displayMilliseconds, 3)

      if(elapsedSeconds < 60)
      {
        timerSeconds.innerHTML = padSpace(displaySeconds, 2) + '.'
      }
      else
      {
        timerSeconds.innerHTML = padZero(displaySeconds, 2) + '.'
        timerMinutes.innerHTML = padSpace(displayMinutes, 2) + ':'
      }
    }

    function resetTimerDisplay()
    {
      var timerMilliseconds = document.getElementById('timerMilliseconds')
      var timerSeconds = document.getElementById('timerSeconds')
      var timerMinutes = document.getElementById('timerMinutes')

      timerMilliseconds.innerHTML = '000'
      timerSeconds.innerHTML = ' 0.'
      timerMinutes.innerHTML = '   '
    }

    var timerInterval
    var startDate
    var stateId = 0

    resetTimerDisplay()

    window.addEventListener("keyup", handleKeyUp)
    window.addEventListener("keydown", handleKeyDown)
  </script>
  <script src="./app.js"></script>
  <script>
    // You can also require other files to run in this process
    /*require('./renderer.js')*/
  </script>
</html>
